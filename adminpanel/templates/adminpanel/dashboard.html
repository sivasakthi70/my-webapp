{% load static %} 
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GreenRoute Admin Dashboard</title>

  <!-- ‚úÖ Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- ‚úÖ Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- ‚úÖ Custom Styles -->
  <style>
    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Poppins", sans-serif;
      color: #333;
      background: linear-gradient(135deg, #d4fc79, #96e6a1, #a1c4fd, #c2e9fb);
      background-size: 300% 300%;
      animation: gradientMove 10s ease infinite;
    }

    @keyframes gradientMove {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .navbar {
      background: linear-gradient(90deg, #2e7d32, #43a047, #1b5e20);
      border-bottom: 3px solid #145a32;
    }
    .navbar-brand {
      font-weight: 700;
      font-size: 1.3rem;
      color: #fff !important;
    }

    /* ‚úÖ Glassmorphism Cards */
    .card {
      border-radius: 18px;
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(10px);
      transition: all 0.3s ease-in-out;
      border: none;
    }
    .card:hover {
      transform: translateY(-6px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    /* ‚úÖ Stats Cards */
    .stats-card {
      color: white;
      border: none;
    }
    .stats-card h2 {
      font-size: 2rem;
      font-weight: bold;
    }
    .stats-card.users {
      background: linear-gradient(135deg, #42a5f5, #1e88e5);
    }
    .stats-card.routes {
      background: linear-gradient(135deg, #66bb6a, #388e3c);
    }
    .stats-card.eco {
      background: linear-gradient(135deg, #ffa726, #f57c00);
    }

    .card-title {
      font-weight: 600;
    }

    /* ‚úÖ Stylish Table */
    table thead {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    /* ‚úÖ Quick Actions */
    .quick-actions a {
      border-radius: 10px;
      font-weight: 600;
      transition: all 0.2s ease-in-out;
    }
    .quick-actions a:hover {
      transform: scale(1.07);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }
  </style>
</head>
<body>

<!-- ‚úÖ Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark sticky-top shadow-sm">
  <div class="container-fluid">
     <a class="navbar-brand" href="{% url 'adminpanel:admin_dashboard' %}">üå± GreenRoute Admin</a>
     <div>
       <a href="{% url 'adminpanel:admin_logout' %}" class="btn btn-outline-light btn-sm">üö™ Logout</a>
     </div>
  </div>
</nav>

<div class="container py-5">
  <h2 class="mb-4 fw-bold text-dark">üìä Dashboard Overview</h2>

  <!-- ‚úÖ Stats Cards -->
  <div class="row g-4 mb-4">
    <div class="col-md-4">
      <div class="card stats-card users text-center shadow-sm">
        <div class="card-body">
          <h6 class="card-title">Total Users</h6>
          <h2>{{ total_users|default:"0" }}</h2>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card stats-card routes text-center shadow-sm">
        <div class="card-body">
          <h6 class="card-title">Total Routes</h6>
          <h2>{{ total_routes|default:"0" }}</h2>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card stats-card eco text-center shadow-sm">
        <div class="card-body">
          <h6 class="card-title">Avg Eco-Cost</h6>
          <h2>{{ avg_ecocost|default:"0" }}</h2>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚úÖ Charts Section -->
  <div class="row g-4">
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">üìà Pollution Trends</h5>
          <canvas id="pollutionChart" height="160"></canvas>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">üåç Eco-Cost Trends</h5>
          <canvas id="ecoCostChart" height="160"></canvas>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-4 mt-2">
    <div class="col-md-12">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">üö¶ Most Used Routes</h5>
          <canvas id="popularRoutesChart" height="180"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚úÖ Tables -->
  <div class="row g-4 mt-2">
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">üë• Active Users</h5>
          <table class="table table-hover align-middle">
            <thead class="table-success">
              <tr><th>User</th><th>Search Count</th></tr>
            </thead>
            <tbody>
              {% for u in active_users %}
                <tr><td>{{ u.username }}</td><td>{{ u.route_count }}</td></tr>
              {% empty %}
                <tr><td colspan="2" class="text-muted text-center">No active users</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">üèôÔ∏è Top Source Cities</h5>
          <table class="table table-hover align-middle">
            <thead class="table-info">
              <tr><th>Source</th><th>Count</th></tr>
            </thead>
            <tbody>
              {% for s in source_stats %}
                <tr><td>{{ s.source }}</td><td>{{ s.total }}</td></tr>
              {% empty %}
                <tr><td colspan="2" class="text-muted text-center">No data</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-4 mt-2">
    <div class="col-md-12">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">üèôÔ∏è Top Destination Cities</h5>
          <table class="table table-hover align-middle">
            <thead class="table-warning">
              <tr><th>Destination</th><th>Count</th></tr>
            </thead>
            <tbody>
              {% for d in destination_stats %}
                <tr><td>{{ d.destination }}</td><td>{{ d.total }}</td></tr>
              {% empty %}
                <tr><td colspan="2" class="text-muted text-center">No data</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚úÖ Quick Actions -->
  <div class="card shadow-sm mt-4">
    <div class="card-body quick-actions">
      <h5 class="card-title">‚öôÔ∏è Quick Actions</h5>
      <a href="{% url 'adminpanel:manage_users' %}" class="btn btn-primary me-2">üë• Manage Users</a>
      <a href="{% url 'adminpanel:view_routes' %}" class="btn btn-success me-2">üõ£Ô∏è View Routes</a>
      <a href="{% url 'adminpanel:admin_logout' %}" class="btn btn-danger">üö™ Logout</a>
    </div>
  </div>
</div>

<!-- ‚úÖ Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- ‚úÖ ChartJS Config -->
<script>
  const pollutionData = JSON.parse('{{ pollution_trends|escapejs }}');
  const ecoData       = JSON.parse('{{ eco_cost_trends|escapejs }}');
  const popularData   = JSON.parse('{{ popular_routes|escapejs }}');

  // Pollution chart
  new Chart(document.getElementById("pollutionChart"), {
    type: "line",
    data: {
      labels: pollutionData.labels.length ? pollutionData.labels : ["No Data"],
      datasets: [{
        label: "Pollution Index",
        data: pollutionData.data.length ? pollutionData.data : [0],
        borderColor: "#1e88e5",
        backgroundColor: "rgba(33,150,243,0.2)",
        fill: true,
        tension: 0.4,
        pointBackgroundColor: "#1565c0"
      }]
    },
    options: { plugins: { legend: { display: true } } }
  });

  // Eco-Cost chart
  new Chart(document.getElementById("ecoCostChart"), {
    type: "line",
    data: {
      labels: ecoData.labels.length ? ecoData.labels : ["No Data"],
      datasets: [{
        label: "Average Eco-Cost",
        data: ecoData.data.length ? ecoData.data : [0],
        borderColor: "#f57c00",
        backgroundColor: "rgba(255,152,0,0.2)",
        fill: true,
        tension: 0.4,
        pointBackgroundColor: "#ef6c00"
      }]
    },
    options: { plugins: { legend: { display: true } } }
  });

  // Popular Routes chart
  new Chart(document.getElementById("popularRoutesChart"), {
    type: "bar",
    data: {
      labels: popularData.labels.length ? popularData.labels : ["No Data"],
      datasets: [{
        label: "Most Used Routes",
        data: popularData.data.length ? popularData.data : [0],
        backgroundColor: ["#66bb6a","#42a5f5","#ffb74d","#ab47bc","#ef5350","#26a69a"],
        borderRadius: 8
      }]
    },
    options: { scales: { y: { beginAtZero: true } }, plugins: { legend: { display: false } } }
  });
</script>

</body>
</html>
